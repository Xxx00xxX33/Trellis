# 改进 brainstorm 流程

## Goal

改进 `/trellis:brainstorm` 流程，使其更高效、更智能，减少无价值的问题，提升用户体验。

## 痛点记录

### 痛点 1：Task 创建时机不对

**现状**：流程设计为先问 1-2 个问题理解需求，形成"有意义的标题"后才创建 task。

**问题**：用户可能希望先创建任务来记录想法，再逐步细化。

**改进**：开始 brainstorm 前应先自检有没有创建 task，没有就先创建，然后再讨论。

### 痛点 2：问了不该问的问题

**现状**：AI 直接问用户问题，包括一些能自己查到的信息。

**问题案例**：
- 问用户"代码是什么样的"，需要用户确认才能继续 → 应该自己看代码仓库
- 问用户"选择哪种方式实现" → 应该先调研市场上类似工具的做法，给出具体可行方案

**改进**：问问题前应该先自检：
1. 这个问题能不能自己查到答案？（代码、文档、搜索）
2. 这个问题是否有价值？是在讨论决策，还是在问"我是否应该去搜索"？

### 痛点 3：缺少前置调研

**现状**：直接问用户开放性问题，如"你想要哪种方式？"

**问题**：用户不一定知道有哪些选项，或者哪种更好。

**改进**：脑爆流程应该是：
1. **先调研** - 用 research agent 或 exa 查市场上类似工具的做法
2. **再提方案** - 根据调研结果 + 项目情况，给出 2-3 个具体可行方案
3. **最后决策** - 让用户在具体方案中选择，而不是从零开始想

### 痛点 4：只看眼前，缺少发散思维（核心痛点）

**现状**：AI 只针对用户描述的当前需求进行讨论，不主动拓展。

**问题案例**：
- 用户说"做 spec 模板"，AI 就只考虑 spec 模板
- 没有主动问"未来可能有 skill 模板、完整 starter kit 吗？"
- 用户不得不自己提出扩展性问题

**Brainstorm 的精髓是发散思维**：
- 主动考虑 **corner cases**
- 主动考虑 **未来演进**（这个功能以后会怎么扩展？）
- 主动考虑 **相关场景**（类似的需求还有哪些？）
- 主动考虑 **边界情况**（网络失败？模板冲突？版本不兼容？）

**改进**：在理解需求后，AI 应该主动发散：

```
我理解你想实现 [当前需求]。

在深入之前，让我考虑几个扩展性问题：

1. **未来演进**：除了 spec 模板，以后可能有 skill 模板、完整 starter kit 吗？
2. **边界情况**：网络失败怎么处理？模板名冲突怎么办？
3. **相关场景**：update 命令是否也需要支持更新模板？

这些是否需要在设计时考虑？
```

**核心原则**：
- 先发散（考虑各种可能性）
- 再收敛（确定 MVP 范围）
- 而不是一开始就局限在用户描述的范围内

## Open Questions

- brainstorm.md 的流程如何改写来体现这些原则？
- 是否需要定义"必须先调研"的触发条件？

## Requirements (evolving)

- 开始 brainstorm 时自动检查/创建 task
- 问问题前先自检问题价值
- 对于技术选型类问题，先调研再提方案
- 避免元问题（"我是否应该去搜索"）

## Acceptance Criteria (evolving)

- [ ] brainstorm 开始时自动创建 task（如果没有）
- [ ] 技术选型问题前有调研步骤
- [ ] 给出的选项是具体可行方案，不是抽象问题

## Technical Notes

### 涉及文件

- `.claude/commands/trellis/brainstorm.md` - brainstorm 流程定义
- `.trellis/scripts/task.py` - 任务创建脚本

### 可能的改进方案

1. **方案 A**：在 brainstorm 开头增加选项
   ```
   开始 brainstorm 前，是否先创建任务目录？
   1. 是，先创建（我有大概的想法）
   2. 否，先聊聊（我还不确定）
   ```

2. **方案 B**：AI 识别用户意图
   - 检测"先创建任务"、"create task first"等关键词
   - 立即响应创建

3. **方案 C**：新增独立命令
   - `/trellis:new-task <name>` - 快速创建空任务
   - brainstorm 自动检测是否已有当前任务
